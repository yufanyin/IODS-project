# Chapter 5: Dimensionality reduction techniques

(25.11.-2.12.2019)

- **Data wrangling**

    R script of data Wrangling exercise is available here.
     
    https://github.com/yufanyin/IODS-project/blob/master/create_human.R
    
## 5.1 Exploring the data numerically and graphically

Load necessary packages

```{r, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
library(tidyr)
library(dplyr)
library(corrplot)
library(ggplot2)
library(GGally)
library(knitr)
library(kableExtra)
library(stringr)
library(ggfortify)
library(factoextra)
```

### 5.1.1 Reading the data

```{r}
human <- read.table(file = "G:/C-Open Data Science/0-191030/IODS-project-master/human_ana.txt")

```

### 5.1.2 Summaries of the variables
**(Step 1a)**

The data are the conbination of two data sets, Human Development Index (HDI) and Gender Inequality Index.

The data consist of 155 observations in 8 variables.

"Country": country name
"edu2F_edu2M": ratio of second education of female/male
"labF_labM": ratio of labour forced female/male
"exp_edu": expected years of education
"exp_life": life expectancy at birth
"GNI": Gross National Income per capita
"mat_mor": maternal mortality ratio
"ado_birth": adolescent birth rate
"F_parli": percetange of female representatives in parliament

```{r}
knitr::kable(summary(human)) %>% kable_styling(bootstrap_options = "striped", position = "center", font_size = 12)
```

### 5.1.3 Graphical overview of the data 
**(Step 1b)**

```{r, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
ov_human <- ggpairs(human, mapping = aes(), title ="Overview of 'human' data", lower = list(combo = wrap("facethist", bins = 20)), upper = list(continuous = wrap("cor", size = 2.8)))
ov_human
```

The overview plot showed the data distributions of all variables and their correlations. GNI, maternal mortality rate and adolescence birth rate showed left skewed distribution representing a increased cound on low rates. On the upper part showed correlations of the variables.

### 5.1.4 Relationships between the variables
**(Step 1c)**

```{r}
cor_human <- cor(human) %>% round(digits = 2)
cor_human %>% knitr::kable(caption = "Correlation between variables") %>% 
  kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "center")
```

```{r}
p.mat <- cor.mtest(cor_human)$p
corrplot(cor_human, method="circle",  type="lower",  tl.cex = 0.6, p.mat = p.mat, sig.level = 0.01, tl.srt = 45, title="Correlations of 'human' data", mar=c(0,0,1,0))
```

Expected years of education strongly positively correlated with Live expectation and strongly negatively correlated with maternal mortality ratio. It indicated that a better education leads to a higher life expectation and contributes to a lower maternal mortality.

Another strong positive correlation was seen between adolescent birth rate and maternal mortality ratio. This may be due to high quality of medical care. 

## 5.2 Principal component analysis (PCA) on unstandardized data

In PCA, the data are first transformed to a new space with equal or less number of dimensions which called the principal components. The 1st principal component captures the maximum amount of variance from the features in the original data. The 2nd principal component is orthogonal to the first and it captures the maximum amount of variability left.

### 5.2.1 Variability captured by the principal components
**(Step 2a)**

```{r}
pca_human <- prcomp(human)
round(pca_human$rotation[,1:2], digits = 4) %>% knitr::kable(caption = "PCA result on all variables") %>% kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "center")
```

```{r}
s1 <- summary(pca_human)
pca_prc1 <- round(100 * s1$importance[2, ], digits = 3) 
round(100 * s1$importance[2, 1:2], digits = 5) %>% knitr::kable(caption = "Principle components") %>% kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "center")
```

### 5.2.2 PCA Biplot displaying the observations by the first two principal components
**(Step 2b)**

The biplot displayed the observations by the first two principal components (PC1 coordinate in x-axis, PC2 coordinate in y-axis), along with arrows representing the original variables.

```{r, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
pca_label1 <-  paste0("GNI (", pca_prc1[1],"%)" )
pca_label2 <-  paste0("Maternal mortality (", pca_prc1[2],"%)" )
biplot(pca_human, choices = 1:2, cex = c(0.55, 0,9), col = c("grey40", "darkgreen"), xlab = pca_label1, ylab = pca_label2, main = "PCA biplot of unstandardized human data", margin =c(0,0,5,0)) 
```


```{r}
autoplot(pca_human, data = human, label= TRUE, label.size = 3.0, colour = "darkgreen", loadings = TRUE, loadings.label = TRUE, loadings.colour = "red",) + ggtitle("PCA biplot of unstandardized human data 2") + xlab(paste0(pca_label1))  + ylab(paste0(pca_label2)) + theme_bw()
```

Principal component 1 (GNI) represents 99.99% of the variance of the unstandardized data. PC2 (maternal mortalility ratio) captures 0.01% of the variance. The Gross National Income per capita explains 99.99% of the principal component 1 of the data.

## 5.3 Principal component analysis (PCA) on standardized data

### 5.3.1 Scaling the data
**(Step 3a)**

The summary of the standardized data is as follows (The mean of all values is 0 and the standard diviation reaches 1).

```{r}
stzd_human <- scale(human)
knitr::kable(summary(stzd_human)) %>% 
  kable_styling(bootstrap_options = "striped", position = "center", font_size = 11)
```

### 5.3.2 Variability captured by the principal components
**(Step 3b)**

```{r}
pca_stzd_human <- prcomp(stzd_human)
round(pca_stzd_human$rotation[, 1:2], digits = 4) %>% knitr::kable(caption = "PC1 & 2 of standardized 'human' data") %>% kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "center")
```

```{r}
s2 <- summary(pca_stzd_human)
pca_prc2 <- round(100 * s2$importance[2, ], digits = 1) 

pca_label2.1 <- paste0("Education and health (",pca_prc2[1],"%) ")
pca_label2.2 <- paste0("Female social participation (",pca_prc2[2],"%) ")

round(100 * s2$importance[2, 1:2], digits = 2) %>% knitr::kable(caption = "Principle components") %>% kable_styling(bootstrap_options = "striped", full_width = FALSE, position = "center")
```

### 5.3.3 PCA Biplot
**(Step 3c)**

```{r, echo=TRUE, results='markdown', message=FALSE, warning=FALSE}
biplot(pca_stzd_human, choices = 1:2, cex = c(0.5, 0,9), col = c("grey40", "deeppink2"), xlab = pca_label2.1, ylab = pca_label2.2, main = "PCA biplot of standardized 'human' data", margin =c(0,0,5,0))
```

```{r}
autoplot(prcomp(stzd_human), data = human, colour = "darkgreen", label= TRUE, label.size = 3.0, loadings = TRUE, loadings.label = TRUE, loadings.colour = "red",) + ggtitle("PCA biplot of standardized 'human' data 2") + xlab(paste0(pca_label2.1))  + ylab(paste0(pca_label2.2)) + theme_bw()
```

















